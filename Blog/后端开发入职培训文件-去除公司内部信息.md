# 规范

设置规范的主要目的是为了确保一致性、安全性和效率。

1. 达成共识。
2. 降低沟通成本。
### 命名规范

"There are only two hard things in Computer Science: cache invalidation and naming things." ——Phil Karlton

命名使用美式英语，而非英式英语。因为大多数编程语言和技术文档都是以美国英语为标准编写的。

电梯 
反例：lift
正例：elevator

组织机构，单位
反例：organisation
正例：organization

橡皮
反例：rubber
正例：eraser

垃圾箱：
反例：bin
正例：trash Can

公寓
反例：flat
正例：apartment

货车
反例：lorry
正例：truck
## 代码规范

**代码是写给人看的，给机器执行的**。

在企业应用级开发中，首要任务是确保代码的可读性，随后才是性能优化。遵循《[阿里巴巴 Java 开发规范](https://developer.aliyun.com/topic/java20)》、《[代码整洁之道](https://book.douban.com/subject/4199741/)》、《[重构](https://book.douban.com/subject/30468597/)》和《[Effective Java](https://book.douban.com/subject/30412517/)》中的指导原则，可以显著减少BUG的出现，提高代码质量。在这之上，再参考 Spring Core 的源码，例如工具类参考 org.springframework.util.StringUtils#hasLength 这种，注释写得非常明白的代码。

下面写的是一些重点内容。

### 代码编写要点

1. 像写报纸一样，写你的代码。
2. 变量和方法出现顺序
	1. public、protected、default（没有修饰符）、private 至上而下。因为你 public 肯定是想别人看见的，private 方法是内部的，不想让外部看见，那就往后放。
	2. static 优先出现于非 static 的变量，final 变量优先于非 final 变量。
	3. 就近原则，相关的变量应该在一起。你肯定不想 class 首部出现 private String template; class 末尾才出现是否处理这个 template 的 boolean 值。
	4. 先调用的变量出现在最前面（推荐）
3. 方法/函数应该尽量短小，最好不要超过 50 行，可以想办法拆分方法。
4. 不要嵌套大于4层，会把人绕晕，也可以通过拆分方法的形式来实现。参见 [Why You Shouldn't Nest Your Code](https://www.youtube.com/watch?v=CFRhGnuXG-4)
5. 单行注释有且仅有一行空格。样例： // 这是一条注释。 // TODO 后续使用二级缓存方式优化
6. 合理重构你的代码。比较复杂的判断，可以用方法包裹起来。例如如下示例，见方法就能知道是什么意思，如果没有订阅信息或者没有订阅则返回错误信息。
![image.png](https://s2.loli.net/2023/12/11/bc5vTwpIJOnFBxX.png)
7. 合理的空格以及空行。类属性、方法之间，需要最少空一行。

更多内容，请参考上面写的书籍/手册，更加精进一步
1. [设计模式之美](https://time.geekbang.org/column/intro/100039001)
2. [代码美学](https://www.youtube.com/@CodeAesthetic)
3. 《[Unix 编程艺术](https://weread.qq.com/web/bookDetail/f1f32dd072021a42f1fbdef)》
### 编写代码规则

1. （非常重要）代码写完后必须按 Ctrl + Alt + L 进行格式化，使用 IDEA 自带的格式化规则。统一格式，避免因为格式导致不必要的各种更新及可能出现的错误。
2. 安装 SonarLint 插件，如果有 warning，尽量按照给的解决方案来实现，使用好该插件，仅仅在编写代码时，就能解决大部分的 BUG。
3. 入口类 CardApplication 应该尽量保持简单，如果需要项目启动前，启动时，启动后进行各种操作，请用 Spring 或者 Spring Boot 事件，搭配 spring.factories 来进行注册。
4. 每写一个接口，最少写一个对应的集成测试，测试自己写的代码是否正确。参考 test 目录下，单元测试使用 Mockito，Controller 的集成测试用 MockMvc + @Transactional。除了参考我写的测试代码，还可以看[这里的测试代码](https://github.com/ThomasVitale/cloud-native-spring-in-action/)。
5. 编写接口时，应当先编写 Req 和 VO 类，让前端知道接口的入参和出参是什么，再编写实际的业务逻辑。
7. 方法的大括号，不要用对称的方式格式化，采用 Google Code Format 的标准。
8. 方法、变量用小驼峰表示，不要用 `_`开头表示变量。类名用大驼峰。
9. 常量用大写加下划线表示。
10. 文件头部必须加上你自己的注释。格式如下，注意，最下面空的一行也是要的。名称改成你自己的名字，在 IDEA -> Settings -> Editor -> File and Code Templates -> 右侧 includes -> File Header 下改成这个，apply 即可。

```java
/**
 * @author young1lin
 * @since 1.0
 */
 
```
## 分布式锁使用规范

使用 Redisson，查看[这里](https://github.com/redisson/redisson/wiki/8.-Distributed-locks-and-synchronizers)，按需开发。

[不靠 Reidisson 实现原理](https://time.geekbang.org/column/article/301092)
# 框架使用规范

## Spring 使用

1. 优先使用构造器注入，其次是 set 注入。原因如下
2. 如果配置很多，且都是一套体系下的，建议采用下面的方式进行调用配置。@ConfigurationProperties + @NestedConfigurationProperty。配置为空也不会报错，并且规范调用，不要一堆的 @Value 导致项目属性过多。
![image.png](https://s2.loli.net/2023/12/11/LgZtSIQ5BiYNy1o.png)
3. 合理的使用 Spring Event 进行解耦，逻辑简单的可以在原本代码中写，逻辑比较复杂的，且有多处代码一致的，使用 Spring Event 机型解耦。继承 java.util.EventObject 这是所有 Java 事件的默认规范。
![image.png](https://s2.loli.net/2023/12/11/n7ax5fGPNpEmUJk.png)

## MyBatis Plus 使用

1. 尽量写能复用的 SQL
2. 一些简单的语句也可以直接用 MyBatis Plus 的 Lambda 的语法进行查询、更新。如下图所示，不要用字符串表示字段，因为字段名可能会变。
![image.png](https://s2.loli.net/2023/12/12/6vVqUklX5IreZSR.png)
3. 尽量使用分页，来减少每一次返回给前端的数据。PageMethod.startPage(pageNo, pageSize);
4. 如果使用分页数据类型转换，用我下面这个工具类进行转换。

```java
import java.util.function.Function;  
  
import org.springframework.util.CollectionUtils;  
  
import com.github.pagehelper.Page;  
  
/**  
 * @author young1lin  
 * @since 1.0 
 */
public final class PageUtil {  
  
    private PageUtil() {  
    }
    
    /**  
     * 转换 Page 对象  
     *  
     * @param originalPage    原来的 Page  
     * @param convertFunction 映射方法  
     * @param <I>             Input  
     * @param <O>             Output  
     * @return 转换后的 page  
     */    
	 public static <I, O> Page<O> convert(Page<I> originalPage, Function<I, O> convertFunction) {  
        Page<O> result = new Page<>(originalPage.getPageNum(), originalPage.getPageSize());  
        result.setTotal(originalPage.getTotal());  
        if (CollectionUtils.isEmpty(originalPage)) {  
            return result;  
        }  
        originalPage.stream()  
                .map(convertFunction)  
                .forEach(result::add);  
        return result;  
    }  
  
}
```

调用测试

```java
@Test  
void convert() {  
    int pageNo = 1;  
    int pageSize = 10;  
    int activeStatus = 2;  
    Page<In> inPage = new Page<>(pageNo, pageSize);  
    inPage.add(new In(1L, 1));  
    inPage.add(new In(2L, activeStatus));  
    inPage.add(new In(3L, 3));  
  
    Page<Out> outPage = PageUtil.convert(inPage, in -> new Out(in.getId(), in.getStatus() == activeStatus));  
    assertEquals(outPage.getPageNum(), pageNo);  
    assertEquals(outPage.getPageSize(), pageSize);  
    assertTrue(outPage.get(1).getIsActive());  
}
```

## Swagger 使用

Swagger 主要输出给前端或者其他服务调用的 API 文档。
1. 可以在这里写明错误码是什么意思。
![image.png](https://s2.loli.net/2023/12/12/WkrERK3xTbe9sB6.png)

# 单元测试编写

单元测试最主要的目的是为了在开发阶段就将问题暴露出来以及方便重构。在装了 SonarLint 后仍然可能有些低级 Bug 无法发现，或者逻辑上的 Bug 没有避免，这时候单元测试就能让你一遍遍重复 review 你写的代码，设置 stub 来 mock 掉外部依赖的内容，合理的断言让你明确你的预期是什么。简单的方法无需单元测试，复杂的方法一定要写。

## 一些准则
	复杂代码的定义：不是简单的查询，更新操作，牵扯到一系列业务需求上的操作。

1. 一个测试方法只做一件事。单一职责
2. 不用百分百覆盖代码，但是一些逻辑复杂的代码需要覆盖到。
3. 写的是单元测试，不是集成测试，所以不需要加 @SpringBootTest 并且不要通过 Mapper 直接访问数据库。
4. 简单的代码，写一下 Controller 类的集成测试即可。
5. 不要求遵守 TDD、BDD，覆盖复杂的代码即可。
## 书籍/文档
1. 《[测试驱动开发的艺术](https://book.douban.com/subject/5326182/)》 
2. 《[单元测试的艺术](https://book.douban.com/subject/25934516/)》
3. [Mockito](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html)
4. [JUnit5](https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations)
### 测试驱动开发的艺术

本书用一个模板替换内容来一步步阐释了如何做好 TDD，写好单元测试。使用的 Java 语言，值得一读。

![image.png](https://s2.loli.net/2024/01/04/lSqtu5239pKwcad.png)

### 单元测试的艺术

这本书用的 C# 来进行单元测试编写指导，和 Java 语法类似。重要的是学习其思想，如何写好一个单元测试，stub、mock、assert 等内容介绍。
### Mockito

推荐使用这个，而非 PowerMock 或者 EasyMock，因为 Mockito 足够简单易用，而且文档完善，是主流测试框架，并且 Spring Boot Test 中自带了。

链接里面是 Mockito 所有的使用方法。至上而下，重点关注
1. stubbing
2. mock
3. verify
4. [`doReturn()`|`doThrow()`| `doAnswer()`|`doNothing()`|`doCallRealMethod()` family of methods](https://javadoc.io/static/org.mockito/mockito-core/5.8.0/org/mockito/Mockito.html#do_family_methods_stubs)
5. [Capturing arguments](https://javadoc.io/static/org.mockito/mockito-core/5.8.0/org/mockito/Mockito.html#captors) for further assertions

### JUnit5

最新的 Spring Boot Test 自带的都是 JUnit5 和 JUnit4 不兼容，且功能更为丰富。自己根据官网的代码一步步写，或者参考我已经写过的单元测试代码。
# IDEA 插件

## SonarLint

从开发阶段解决常见的 BUG，不要忽视插件的警告，尽量按照提示解决警告的内容。
## CodeGeekx / 通义灵码（TongYILingma）/ Copilot / Amazon Q

利用 AIGC 提高效率。

包括但不限于以下功能交给 AI：

1. 正则表达式编写
2. 复杂 SQL 编写
3. 需求实现表设计
4. 技术选择/调研
5. 代码重构
6. 单元测试代码编写
7. Shell 命令解释，样例编写
8. 代码续写（按 Tab 键自动续写，但是不建议一直开着）
## Key Promoter X

每次鼠标点击，都会提示你对应的快捷键是什么。IDEA 快捷键很重要，尽量少用鼠标，能提升开发速度。

## PlantUML Integration

安装这个插件，用特定语法绘制 UML 图。
## MyBatisX

右键 DataGrid 可以一键生成对应的 Mapper、Entity 等等。

![image.png](https://s2.loli.net/2023/12/12/6bONW35sVFvfugo.png)

## MyBatis Log Free

平常 SQL 打印会打印出占位符，而不是直接打印完整的 SQL，使用这个插件可以完整打印 SQL。

## Jump To Line

官方插件，帮你 Debug 想跳哪一行，跳到哪一行，甚至能回退到 breakpoint 当前方法的前面行的代码。
## CodeGlance Pro

代码一览，右侧缩略图

# 数据库设计/复杂问题解决方案设计

优先使用下面的 LLMs 来解决这些问题，越复杂的内容，越要丢给下面的 LLMs 解决。

| 名称 | 地址 | 是否收费 | 是否推荐 | 说明 |
| ---- | ---- | ---- | ---- | ---- |
| ChatGPT4 | https://chat.openai.com | 是 | 是 | 当前最强 LLM，完美理解上下文意思，能上传附件，上下文内容可以非常大。 |
| Claude2 | https://claude.ai/ | 否 | 是 | 免费的就能用，但不支持生成图片，生成语音等 |
| 通义千问 | https://tongyi.aliyun.com/qianwen | 否 | 否 | 除了文心一言4.0，这个是最好的国产大模型了 |
| 文心一言-4.0 | https://yiyan.baidu.com/ | 是 | 勉强 | 毕竟收费，且不是最强的 |
| GPT3.5 | https://chat.openai.com | 否 | 勉强 | 一般，但是比文心一言 3.5 强太多，可以先使用这个免费的 |
| 智普清言 | https://chatglm.cn/main/detail | 否 | 勉强 | 底层为 ChatGLM-3 最新的为 ChatGLM-4 |
| Gemini Pro | https://bard.google.com/ | 否 | 否 | 目前不推荐，很垃圾，不如 GPT3.5，中文理解能力甚至不如文心一言 3.5 |
| 其他国产大模型产品 |  |  | 否 | 文心一言、腾讯混元、讯飞星火免费版的很垃圾，不推荐使用。 |
## 样例

通过描述表结构以及需求描述，完成了更新 card_task 中声音训练任务名称为空的任务名称为 tb_card 里面的 person_name + "的声音-" + [第几个训练成功的声音]。

张三的声音-0 这种。

```sql
UPDATE card_task ct  
    INNER JOIN (SELECT id,  
                       uid,  
                       concat(t.person_name, '的声音-',  
                              @rn := CASE WHEN @uid = uid THEN @rn + 1 ELSE 1 END) as task_name,  
                       @uid := uid  
                FROM (SELECT card_task.id,  
                             card_task.uid,  
                             person_name  
                      FROM card_task  
                               LEFT JOIN tb_card p ON card_task.uid = p.uid  
                      WHERE task_name IS NULL  
                        AND task_type = 2  
                        AND task_status IN (2, 5, 6)  
                      ORDER BY card_task.uid, card_task.create_time) t  
                         JOIN (SELECT @uid := null, @rn := 0) r) temp  
    ON ct.id = temp.id  
SET ct.task_name = temp.task_name  
WHERE ct.task_name IS NULL  
  AND task_type = 2  
  AND task_status IN (2, 5, 6);
```

# 10x 程序员
## 正确解决问题的方法

1. 使用英文描述你的问题
2. 使用 Google/Bing 

就结合这两个方法，能帮你解决绝大部分问题。如果是很久已经存在过的问题，不是最新的问题，可以使用 ChatGPT 或者通义千问以对话的形式解决问题。
## 书籍/专栏
### 工作

1. 《[高效程序员的45个习惯](https://book.douban.com/subject/4164024)》
2. 《[金字塔原理](https://book.douban.com/subject/33391219/)》
3. [10x 程序员工作法](https://time.geekbang.org/column/intro/100022301)
4. 《[高效能人士的七个习惯](https://weread.qq.com/web/bookDetail/56d325907203e8a856def7f)》
5. 《[卓有成效的管理者](https://weread.qq.com/web/bookDetail/65832ed0717f792e6582b00)》
6. 《[搞定1](https://weread.qq.com/web/bookDetail/c0e328b05cf118c0e998aee)》
7. 《[心流](https://weread.qq.com/web/bookDetail/65e328b05e10e265eb76e03)》
8. 《[思考，快与慢](https://weread.qq.com/web/bookDetail/af83263058c217af81f8979)》
### 学习
1. [费曼学习法2.0](https://www.bilibili.com/video/BV1fC4y1W767)
2. 《[掌控习惯](https://weread.qq.com/web/bookDetail/bcb32150719afe3bbcbad52) Atomic Habits》
3. 《[Ultralearning](https://weread.qq.com/web/bookDetail/95e32300811e7e249g014280)》
## 视频

1. [芯片工程师的一天 | 我如何每天高效工作12小时？](https://www.bilibili.com/video/BV1Fv411b7gs)
2. [The 8 most important study techniques I use in medical school](https://www.youtube.com/watch?v=lyJqgL3Zp4E)

## 高效程序员的 45 个习惯

没有直接提到敏捷，但是处处是敏捷。

## 金字塔原理

结构化思维，自上而下思考，以上统下，逐层细化，分门别类，有效沟通，逻辑表达清晰。

## 工作计划编写建议

每天做了什么，要做什么，通过结构化思维，自上而下将问题拆解至可执行的部分，以 TODO list 的形式写下来。方便月度绩效总结，每周周报编写。也可以通过自下而上的方式（头脑风暴）将所有要解决的任务的点一一列出，并进行归纳总结。

情况如下，年文件夹 -> 月/ 月附件 -> 具体日期.md

[![pinUExH.png](https://z1.ax1x.com/2023/10/31/pinUExH.png)](https://imgse.com/i/pinUExH)

公司没有要求写日报，但是你把每天的工作内容写下来，相关的截图、文本、附件保存下来，你只需要看每周的文档即可回忆这个星期做了什么，看每个月的文档，就可以知道这个月做了什么。

## 搞定1 Get Things Done

先把所有的工作任务写下来，放入你的”工作篮“，而非记在脑子里。把最容易的先做了，难的事情往后推。定期 review 你做过的事情，根据优先级 + 实际情况灵活调整你的任务，保持放松的心态。

保持放松的心态可以通过最简单的深呼吸，以及进阶的冥想来实现。

《[原则1](https://weread.qq.com/web/bookDetail/848324405e0fe08483ab6a4)》、《[软技能2](https://weread.qq.com/web/bookDetail/d7432d00813ab820bg010313)》也是教你，先确定一个目标，没有目标的人就像海上随处飘荡的船，你是不可能到达指定的目的地的。

## 费曼学习法

学习是一个输入、处理（理解、记忆）、输出（结合自身已有知识，加强记忆）的一个过程。只有输入足够多的内容，并充分理解、记忆和应用，才能建立系统完善的知识体系，才能如有神助，胸有成竹。

费曼学习法是以美国理论物理学家理查德·费曼的学习方式命名的一种学习方法。这种方法特别强调了理解和教学的重要性，被广泛认为是一种非常有效的深入学习和理解复杂概念的手段。费曼学习法可以分为以下几个核心步骤：

1. **选择学习主题**：首先，选择一个你想要学习和理解的主题或概念。（**明确你的目标，很重要**）
2. **学习**：通过阅读书籍、听课、观看视频讲座等方式来学习选定的主题。在这个阶段，重点是尽可能多地吸收信息和知识。
3. **解释**：尝试用自己的话来解释这个主题。这一步是费曼学习法的核心。你应该像是在向一个完全不了解这个主题的人解释一样。目的是用最简单、最基础的术语表达出来，确保即使是非专业人士也能理解。
4. **识别问题**：在解释过程中，你可能会遇到一些解释不清楚或者不够深入的地方。这些就是你理解不够透彻的部分。
5. **回顾和巩固**：针对那些你无法清楚解释的部分，返回到你的学习材料中，重新学习和理解这些概念。可能需要重复这个步骤多次，直到你能够清晰、准确地解释这个概念。
6. **简化和使用类比**：尽量简化你的解释，并尝试使用类比来帮助解释复杂的概念。良好的类比可以帮助你和听众更好地理解材料。

费曼学习法的精髓在于它的反馈循环：通过尝试教授他人，你可以更清楚地了解自己对材料的理解程度。这种方法强调了理解而不是记忆，鼓励深度学习和主动思考。通过这种方式，你可以有效地提高自己的学习效率和理解能力。

如果没有输出，根本就不可能长时间掌握该技能，并且根据遗忘曲线（Forgetting curve）理论，应该反复复习，回想你学到的那个知识点。
## Atomic Habits

每天进步 1%，一年后是 37.78 倍的成长，每天退步 1%，一年后只有最开始的 3.03%，这，就是复利的力量。养成一个良好的习惯，能助力你飞速成长。当然，现实情况下人很难做到每天比昨天进步 1%，因为如何每天都如此，第二年会是最开始的 1427 倍。

习惯的养成分为四个阶段：

1. 提示(Cue)：找到触发习惯的提示,这可能是一个时间、地点、情绪状态、行为或其他前导信号。
2. 渴望(Craving)：提出一个明确的目标或者渴望。让大脑期待奖励的到来。
3. 响应(Response)：选择一个可以满足渴望的简单行为。这个响应接近提示时最容易实现。
4. 奖励(Reward)：奖励自己，让大脑和身体都习惯这个积极的循环。确保提示-渴望-响应后的奖励及时到达。

养成一个好的习惯，就创建一个提示随处可见，提升渴望程度的环境。让响应没有那么高成本，一开始只做 3 分钟法则，时间超了就不继续，让奖励更容易产生或者获取。

一个职场人士想要提高工作效率。他使用电子邮件通知作为提示，激发渴望即时完成工作任务。他的响应是立即处理或计划处理邮件。作为奖励，他可能会在完成一定数量的工作后给自己放松时间。

# 文档编写

1. [中文文档编写开源指北](https://github.com/ruanyf/document-style-guide)
2. [Markdown 语法](https://chrisniael.gitbooks.io/gitbook-documentation/content/format/markdown.html)
3. [Markdown 中文文档](https://markdown-zh.readthedocs.io/en/latest/) 
# 软件安装

## 数据库管理工具

| 类别 | 名称 | 链接 | 是否收费 | 是否推荐 | 说明 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| MySQL | DataGrip | [DataGrip](https://www.jetbrains.com/datagrip/) | 是 | 是 | [激活码相关的在这](https://www.idejihuo.cn/) |
|  | MySQL Workbench | [官方软件](https://www.mysql.com/products/workbench/) | 否 | 是 | 推荐导入大量数据的时候用这个 |
|  | Navicat |  | 是 | 不推荐 |  |
| Redis | Redisinsight | Redisinsight | 可以用免费版 | 是 |  |
|  | RedisDesktopManager | RDM | 否 | 是 |  |
## Markdown 编辑器
1. Typora （如果没有购买，可以看下面开源免费的软件）
2. Obsidian